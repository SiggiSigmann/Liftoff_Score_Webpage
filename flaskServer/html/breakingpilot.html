<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>Liftoff Scores</title>
		<link rel="shortcut icon" href="{{ url_for('static', filename='logo.jpg') }}" type="image/x-icon">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='menu.css') }}">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='footer.css') }}">
		<!--<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='tabel.css') }}">-->

		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<!--based on https://www.w3schools.com/howto/tryit.asp?filename=tryhow_js_sidenav-->
		{% include "menu.html" %}
		
		<div id="main">
			<center>
				<h1>Breaking Pilot</h1>
			</center>
			<span style="font-size:30px;cursor:pointer" onclick="openNav()" align="left">☰ Open Menu</span>
			<center>
				<br>
				<br>
				<br>
				<br>
				<br>
				<br>
				<br>
				<br>
				<p id="current"></p>
				<p id="inARow"></p>
				<br>
				<br>
				<div id="fancy_from">
					<form action="/breakingpilot" method="POST">
						<table>
							<tr>
								<td>User</td>
								<td>
									<select  id="userid" name="userid" required>
										{% for user in users %}
											<option value="{{ user[0] }}" style="background: {{ user[2] }};">{{ user[1] }}</option>
										{% endfor %}
									</select>
								</td>
							</tr>
							<tr>
								<td>
									Ehrenhalber<input type="radio" id="mode" name="mode" value="e" checked="checked">
								</td><td>
									Verdientermaßen <input type="radio" id="mode" name="mode" value="v">
								</td>
							</tr>
							<tr>
								<td colspan="2"><button type="submit">Add Breaking Pilot</button></td>
							</tr>
						</table>
					</form>
					<br>
					{% if success == 0 %}
						<p style="color: red;">ERROR</p>
					{% elif success == 1 %}
						<p style="color: green;">Success</p>
					{% else %}
						<br>
					{% endif %}
				</div>
				<br>
				<br>
				<table id="fancy_tabel">
					<tr>
						<th>UserID</th>
						<th>Time</th>
						<th>Mode</th>
					</tr>

				</table>
				<script>
					var breaking = JSON.parse('{{ breaking | tojson | safe}}');
					var users = JSON.parse('{{ users | tojson | safe}}');

					var label = document.getElementById("current");
					label.innerText = "Current Breaking Pilot is "+users[breaking[breaking.length-1][0]-1][1]+" ("+ (breaking[breaking.length-1][2] === 'e' ? 'Ehrenhalber' : 'Verdientermaßen') + ")";
				
					var tabel = document.getElementById("fancy_tabel");
					breaking.forEach(element => {
						var z1 =  document.createElement('tr');
						var s1 =  document.createElement('tr');
						s1.innerText = users[element[0]-1][1]
						z1.appendChild(s1)
						var s1 =  document.createElement('th');
						s1.innerText = element[1];
						z1.appendChild(s1)
						var s1 =  document.createElement('th');
						s1.innerText = (element[2] === 'e' ? 'Ehrenhalber' : 'Verdientermaßen')
						z1.appendChild(s1)
						tabel.appendChild(z1)
					});

					var inARowCount = Array(users.length+1).fill(0)
					var oldUser = 0
					var counter = 1
					breaking.forEach(element => {
						if(oldUser == element[0]-1){
							counter++;
						}else{
							if(counter > inARowCount[oldUser]){
								inARowCount[oldUser] = counter;
							}
							oldUser = element[0]-1;
							counter = 1;
						}
					})
					if(counter > inARowCount[oldUser]){
						inARowCount[oldUser] = counter;
					}

					var most = inARowCount.indexOf(Math.max(...inARowCount));

					var mostInRow = document.getElementById("inARow");
					mostInRow.innerText = "Most in a row: " + users[most][1] + " " + inARowCount[most] + " times";


				
				</script>
			</center>
		</div>
		{% include "footer.html" %}
	</body>
</html>